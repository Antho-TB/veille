
        <!DOCTYPE html>
        <html lang="fr">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Fiche Contr√¥le - Nouveaut√©s</title>
            <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
            <style>
                * { margin: 0; padding: 0; box-sizing: border-box; }
                
                body { 
                    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
                    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                    color: #212529; 
                    padding: 20px;
                    line-height: 1.6;
                    min-height: 100vh;
                }
                
                .container { 
                    max-width: 1200px; 
                    margin: 0 auto; 
                    background: white; 
                    box-shadow: 0 10px 40px rgba(0,0,0,0.08);
                    border-radius: 12px; 
                    overflow: hidden;
                    animation: slideIn 0.5s ease-out;
                }
                
                @keyframes slideIn {
                    from { opacity: 0; transform: translateY(20px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                
                /* Header */
                .header { 
                    background: linear-gradient(135deg, #1a1f36 0%, #2d3748 100%);
                    color: white; 
                    padding: 35px 40px; 
                    text-align: center;
                    position: relative;
                    border-bottom: 3px solid #d64545;
                }
                
                .header-logos {
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    gap: 20px;
                    margin-bottom: 20px;
                }
                
                .header-logos img {
                    height: 55px;
                    width: auto;
                    padding: 10px;
                    border-radius: 6px;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
                }
                
                .header-logos img:first-child { background: white; }
                .header-logos img:last-child { background: #2d3748; border: 2px solid rgba(255,255,255,0.2); }
                
                .header h1 { 
                    font-size: 2.2em; 
                    font-weight: 600; 
                    margin-bottom: 10px; 
                    letter-spacing: -0.3px;
                }
                
                .header-info { 
                    font-size: 0.95em; 
                    opacity: 0.9; 
                    margin-top: 8px; 
                    font-weight: 300;
                }
                
                /* Intro */
                .intro { 
                    padding: 30px 40px; 
                    background: #f8f9fa;
                    border-bottom: 1px solid #dee2e6;
                    text-align: center;
                }
                
                .intro strong { 
                    color: #1a1f36; 
                    display: block; 
                    margin-bottom: 10px; 
                    font-size: 1.2em;
                    font-weight: 600;
                }
                
                .intro p { 
                    margin: 6px 0; 
                    font-size: 0.95em; 
                    color: #495057;
                    max-width: 800px;
                    margin-left: auto;
                    margin-right: auto;
                }
                
                .intro .auto-info { 
                    font-size: 0.88em; 
                    color: #6c757d; 
                    margin-top: 14px; 
                    padding: 10px 18px;
                    background: white;
                    border-radius: 6px;
                    display: inline-block;
                    border: 1px solid #e9ecef;
                }

                .warning-text {
                    color: #c53030;
                    font-weight: 600;
                    margin-top: 15px !important;
                    background-color: #fff5f5;
                    padding: 10px;
                    border-radius: 4px;
                    border: 1px solid #feb2b2;
                    display: inline-block;
                }
                
                /* Content */
                .content { padding: 35px; }
                
                .theme-section { 
                    margin-bottom: 35px;
                    animation: fadeIn 0.5s ease-out;
                }
                
                @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(15px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                
                .theme-header { 
                    background: linear-gradient(135deg, #1a1f36 0%, #2d3748 100%);
                    color: white; 
                    padding: 16px 22px; 
                    font-size: 1.15em; 
                    font-weight: 600;
                    border-radius: 8px;
                    margin-bottom: 18px;
                    box-shadow: 0 2px 8px rgba(26, 31, 54, 0.15);
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    border-left: 4px solid #d64545;
                }
                
                .theme-header::before { content: 'üìÇ'; font-size: 1.2em; }
                
                /* Items */
                /* Items - Style LMS Auditeur */
                .item { 
                    background: white;
                    border: 1px solid #dee2e6;
                    border-radius: 8px;
                    padding: 22px; 
                    margin-bottom: 25px;
                    box-shadow: 0 1px 3px rgba(0,0,0,0.06);
                    transition: all 0.25s ease;
                    position: relative;
                    border-left: 6px solid #6c757d;
                }
                
                .item.crit-haute { border-left: 6px solid #dc2626; }
                .item.crit-moyenne { border-left: 6px solid #f59e0b; }
                .item.crit-basse { border-left: 6px solid #10b981; }
                
                .item:hover { 
                    border-color: #adb5bd;
                    box-shadow: 0 8px 15px rgba(0,0,0,0.08);
                    transform: translateY(-2px);
                }
                
                .filter-bar {
                    background: white;
                    padding: 15px 40px;
                    display: flex;
                    justify-content: center;
                    gap: 15px;
                    border-bottom: 1px solid #eee;
                    position: sticky;
                    top: 0;
                    z-index: 100;
                    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
                }

                .filter-btn {
                    padding: 8px 16px;
                    border-radius: 20px;
                    font-size: 0.85em;
                    font-weight: 600;
                    cursor: pointer;
                    border: 1px solid #ddd;
                    background: #f8f9fa;
                    transition: all 0.2s;
                    color: #4b5563;
                }

                .filter-btn.active { background: #1a1f36; color: white; border-color: #1a1f36; }
                .filter-btn.crit-haute:hover { background: #fee2e2; color: #991b1b; }
                .filter-btn.crit-moyenne:hover { background: #fef3c7; color: #92400e; }
                .filter-btn.crit-basse:hover { background: #d1fae5; color: #065f46; }
                
                .item-header { 
                    display: flex; 
                    justify-content: space-between; 
                    align-items: flex-start; 
                    margin-bottom: 14px;
                    gap: 14px;
                }
                
                .item-title { 
                    font-weight: 600; 
                    font-size: 1.05em; 
                    color: #1a1f36; 
                    flex-grow: 1;
                    line-height: 1.4;
                }
                
                .item-title a { color: #1a1f36; text-decoration: none; transition: color 0.2s; }
                .item-title a:hover { color: #d64545; }
                
                .row-badge { 
                    background: #f8f9fa; color: #495057; 
                    padding: 5px 12px; border-radius: 16px; 
                    font-size: 0.75em; font-weight: 600;
                    white-space: nowrap; border: 1px solid #dee2e6;
                }
                
                .item-meta { display: flex; gap: 10px; margin-bottom: 14px; flex-wrap: wrap; }
                
                .tag { 
                    background: #f8f9fa; color: #495057;
                    padding: 5px 11px; border-radius: 5px; 
                    font-size: 0.85em; font-weight: 500;
                    border: 1px solid #e9ecef;
                }
                
                .item-action { 
                    background: #fff3cd; color: #856404; 
                    padding: 15px 17px; border-radius: 6px; 
                    margin-bottom: 16px; border-left: 3px solid #ffc107;
                    font-size: 0.95em; line-height: 1.6;
                }
                
                .item-action strong { color: #664d03; display: block; margin-bottom: 5px; }
                
                /* Barres de statut (Cases √† cocher) */
                .status-bar {
                    display: flex;
                    gap: 12px;
                    margin-bottom: 15px;
                    flex-wrap: wrap;
                    padding-bottom: 15px;
                    border-bottom: 1px solid #f1f3f5;
                }

                .status-option {
                    display: flex;
                    align-items: center;
                    gap: 6px;
                    background: #f8f9fa;
                    padding: 8px 14px;
                    border-radius: 20px;
                    border: 1px solid #e9ecef;
                    cursor: pointer;
                    font-size: 0.9em;
                    font-weight: 500;
                    transition: all 0.2s;
                }

                .status-option:hover {
                    background: #e9ecef;
                    border-color: #ced4da;
                }

                .status-option input[type="radio"] {
                    accent-color: #1a1f36;
                    width: 16px;
                    height: 16px;
                    cursor: pointer;
                }

                /* Zone Observations */
                .obs-section { margin-top: 10px; }

                .obs-label {
                    font-weight: 600;
                    color: #1a1f36;
                    margin-bottom: 8px;
                    display: block;
                    font-size: 0.95em;
                }
                
                textarea { 
                    width: 100%; padding: 12px; border: 1px solid #ced4da; 
                    border-radius: 6px; height: 85px; 
                    font-family: inherit; font-size: 0.93em; resize: vertical;
                    transition: all 0.2s;
                }
                
                textarea:focus { outline: none; border-color: #1a1f36; box-shadow: 0 0 0 3px rgba(26, 31, 54, 0.08); }
                
                /* Footer */
                .footer { 
                    text-align: center; padding: 28px; background: #f8f9fa;
                    color: #6c757d; font-size: 0.85em;
                    border-top: 1px solid #dee2e6; font-weight: 500;
                }
                
                @media print {
                    body { background: white; padding: 0; }
                    .container { box-shadow: none; border-radius: 0; }
                    .item { page-break-inside: avoid; border: 1px solid #ccc; }
                }
                
                /* Interactivity UI */
                .saving { opacity: 0.6; pointer-events: none; }
                .save-indicator {
                    position: fixed; bottom: 20px; right: 20px;
                    background: #1a1f36; color: white;
                    padding: 10px 20px; border-radius: 30px;
                    font-size: 0.8em; display: none; z-index: 1000;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                }
                .item.removed {
                    transform: translateX(100px);
                    opacity: 0;
                    margin-top: -100px;
                    transition: all 0.5s ease-in-out;
                }
                .item.processed {
                    opacity: 0.5;
                    filter: grayscale(1);
                    pointer-events: none;
                    border-color: #dee2e6 !important;
                    background: #f8f9fa !important;
                }
            </style>
        </head>
        <body>
            <div id="save-indicator" class="save-indicator">Synchronisation en cours...</div>
            <div class="container">
                <div class="header">
                    <div class="header-logos">
                        <img src="../assets/logo_gdd.png" alt="GDD Logo">
                        <img src="../assets/logo_tb.png" alt="TB Groupe Logo">
                    </div>
                    <h1>Fiche de Contr√¥le - Nouveaut√©s</h1>
                    <div class="header-info">
                        G√©n√©r√© le 18/02/2026 √† 13:32<br>
                        Pour l'√©quipe Qualit√© de TB Groupe
                    </div>
                </div>
        
            <div class="filter-bar">
                <button class="filter-btn active" onclick="filterItems('all', 'all', this)">Tout (7)</button>
                <button class="filter-btn crit-haute" onclick="filterItems('crit', 'Haute', this)">üü• Haute (4)</button>
                <button class="filter-btn crit-moyenne" onclick="filterItems('crit', 'Moyenne', this)">üüß Moyenne (2)</button>
                <button class="filter-btn crit-basse" onclick="filterItems('crit', 'Basse', this)">üü® Basse (1)</button>
                <button class="filter-btn" style="border-color: #8b5cf6; color: #8b5cf6;" onclick="filterItems('type', 'MEC', this)">√Ä mettre en place (7)</button>
            </div>
        
                <div class="intro">
                    <strong>üÜï Checklist Nouveaut√©s</strong>
                    <p>Cette fiche pr√©sente les nouveaux textes d√©tect√©s par l'IA qui n√©cessitent une √©valuation initiale. Qualifiez l'impact pour GDD et d√©terminez les actions √† mettre en place.</p>
                    <p class="auto-info">‚ÑπÔ∏è Automatisation : L'IA scanne le web quotidiennement √† 8h00 et filtre les textes pertinents pour GDD (ICPE, M√©taux, HSE). Une fois √©valu√©s (date saisie dans le Google Sheet), les items sont automatiquement transf√©r√©s vers la Base Active.</p>

                </div>
            <div class="content">
            <div class="theme-section">
                <div class="theme-header">Non class√© (1)</div>
            
                <div class="item crit-basse" data-crit="Basse" data-type="MEC" data-proof="Non">
                    <div class="item-header">
                        <div class="item-title">
                            <span class="row-badge">Sheet Ligne: 452</span>
                            <a href="https://info-secheresse.fr/nappes-phreatiques/france/ain-01" target="_blank">Ain (01) - Nappes phr√©atiques | Info S√©cheresse</a>
                        </div>
                    </div>
                    <div class="item-meta">
                        <span class="tag">üìÖ Texte: </span>
                        <span class="tag">üìÑ Type: Arr√™t√© Pr√©fectoral / Portail r√©glementaire</span>
                        <span class="tag">üîç Dern. √âval: </span>
                        <span class="tag bg-red-100 text-red-800" id="proof-tag-452">‚ùå En attente de preuve physique</span>
                    </div>
                    
                    <div class="item-action">
                        <strong>üëâ Action / R√©sum√© :</strong>
                        Le texte concerne les arr√™t√©s de restriction d'eau li√©s √† la s√©cheresse. Bien que l'en-t√™te mentionne l'Ain (01), le document identifie explicitement le Puy-de-D√¥me (63), d√©partement d'implantation de GDD. En tant qu'ICPE consommant environ 1000 m3 d'eau par an (notamment pour la tribofinition et les process de refroidissement), GDD est directement soumise aux seuils de restriction (Alerte, Alerte Renforc√©e, Crise) impos√©s par la pr√©fecture du 63. (Action: Obligation de mise en conformit√©)
                    </div>

                    <div class="item-action" style="background: #f0f7ff; border-left-color: #0ea5e9; margin-top: 10px;">
                        <strong>üõ°Ô∏è Preuve attendue (Audit) :</strong>
                        <textarea id="proof_452" style="font-size: 0.9em; color: #1e40af; font-style: italic; background: transparent; border: 1px dashed #0ea5e9; height: 60px; margin-top: 5px;"
                                  onblur="syncProof(452, this.value)">Non sp√©cifi√©e</textarea>
                    </div>

                    <div class="status-bar">
                        <label class="status-option">
                            <input type="radio" name="status_452" value="conforme" onclick="executeAction('conforme', 452)"> ‚úÖ Conforme
                        </label>
                        <label class="status-option">
                            <input type="radio" name="status_452" value="non_conforme" onclick="executeAction('non_conforme', 452)"> ‚ùå Non Conforme
                        </label>
                        <label class="status-option" style="background: #fee2e2; border-color: #fca5a5;">
                            <input type="checkbox" id="proof_check_452"  
                                   onchange="toggleProof(452, this.checked)"> üìÅ Preuve Dispo
                        </label>
                        <label class="status-option">
                            <input type="radio" name="status_452" value="info" onclick="executeAction('info', 452)"> ‚ÑπÔ∏è Pour Info
                        </label>
                    </div>
                        <label class="status-option">
                            <input type="radio" name="status_452" value="supprimer" onclick="executeAction('supprimer', 452)"> üóëÔ∏è Supprimer
                        </label>
                    </div>

                    <div class="obs-section">
                        <label class="obs-label">Observations :</label>
                        <textarea id="obs_452" placeholder="Saisir vos remarques ici..." 
                                  onblur="syncObservation(452, this.value)"></textarea>
                    </div>

                </div> </div>
            <div class="theme-section">
                <div class="theme-header">D√©chets, ICPE (1)</div>
            
                <div class="item crit-haute" data-crit="Haute" data-type="MEC" data-proof="Non">
                    <div class="item-header">
                        <div class="item-title">
                            <span class="row-badge">Sheet Ligne: 37</span>
                            <a href="https://www.google.com/search?q=D√©cret+n¬∞+47/2023+:+controverse+sur+la+responsabilit√©+des+..." target="_blank">D√©cret n¬∞ 47/2023 : controverse sur la responsabilit√© des ...</a>
                        </div>
                    </div>
                    <div class="item-meta">
                        <span class="tag">üìÖ Texte: 30/01/2023</span>
                        <span class="tag">üìÑ Type: D√©cret</span>
                        <span class="tag">üîç Dern. √âval: </span>
                        <span class="tag bg-red-100 text-red-800" id="proof-tag-37">‚ùå En attente de preuve physique</span>
                    </div>
                    
                    <div class="item-action">
                        <strong>üëâ Action / R√©sum√© :</strong>
                        Le d√©cret 47/2023 concerne la responsabilit√© des [√©l√©ments non sp√©cifi√©s dans l'extrait]. Il est impossible de d√©terminer son impact exact sur GDD sans plus d'informations. (Action: D√©terminer le contenu pr√©cis du d√©cret 47/2023 afin d'√©valuer son impact sur les activit√©s de GDD et identifier les actions de mise en conformit√© n√©cessaires.)
                    </div>

                    <div class="item-action" style="background: #f0f7ff; border-left-color: #0ea5e9; margin-top: 10px;">
                        <strong>üõ°Ô∏è Preuve attendue (Audit) :</strong>
                        <textarea id="proof_37" style="font-size: 0.9em; color: #1e40af; font-style: italic; background: transparent; border: 1px dashed #0ea5e9; height: 60px; margin-top: 5px;"
                                  onblur="syncProof(37, this.value)">Attestation d'adh√©sion √† un √©co-organisme agr√©√© (ex: Valobat, Ecomin√©ro) et pr√©sence des √©co-contributions sur les factures de vente.</textarea>
                    </div>

                    <div class="status-bar">
                        <label class="status-option">
                            <input type="radio" name="status_37" value="conforme" onclick="executeAction('conforme', 37)"> ‚úÖ Conforme
                        </label>
                        <label class="status-option">
                            <input type="radio" name="status_37" value="non_conforme" onclick="executeAction('non_conforme', 37)"> ‚ùå Non Conforme
                        </label>
                        <label class="status-option" style="background: #fee2e2; border-color: #fca5a5;">
                            <input type="checkbox" id="proof_check_37"  
                                   onchange="toggleProof(37, this.checked)"> üìÅ Preuve Dispo
                        </label>
                        <label class="status-option">
                            <input type="radio" name="status_37" value="info" onclick="executeAction('info', 37)"> ‚ÑπÔ∏è Pour Info
                        </label>
                    </div>
                        <label class="status-option">
                            <input type="radio" name="status_37" value="supprimer" onclick="executeAction('supprimer', 37)"> üóëÔ∏è Supprimer
                        </label>
                    </div>

                    <div class="obs-section">
                        <label class="obs-label">Observations :</label>
                        <textarea id="obs_37" placeholder="Saisir vos remarques ici..." 
                                  onblur="syncObservation(37, this.value)">https://fluidsandlubricants.com/2026/01/26/decret-n-47-2023-controverse-sur-la-responsabilite-des-producteurs-au-chili/</textarea>
                    </div>

                </div> </div>
            <div class="theme-section">
                <div class="theme-header">EAU (1)</div>
            
                <div class="item crit-moyenne" data-crit="Moyenne" data-type="MEC" data-proof="Non">
                    <div class="item-header">
                        <div class="item-title">
                            <span class="row-badge">Sheet Ligne: 47</span>
                            <a href="https://www.google.com/search?q=Arr√™t√©+du+2+f√©vrier+1998+relatif+aux+pr√©l√®vements+et+√†+la+consommation+d'eau+ainsi+qu'aux+√©missions+de+toute+nature+des+installations+class√©es+pour+la+protection+de+l'environnement+soumises+√†+autorisation+(Actualisations)" target="_blank">Arr√™t√© du 2 f√©vrier 1998 relatif aux pr√©l√®vements et √† la consommation d'eau ainsi qu'aux √©missions de toute nature des installations class√©es pour la protection de l'environnement soumises √† autorisation (Actualisations)</a>
                        </div>
                    </div>
                    <div class="item-meta">
                        <span class="tag">üìÖ Texte: 02/02/1998</span>
                        <span class="tag">üìÑ Type: Arr√™t√©</span>
                        <span class="tag">üîç Dern. √âval: </span>
                        <span class="tag bg-red-100 text-red-800" id="proof-tag-47">‚ùå En attente de preuve physique</span>
                    </div>
                    
                    <div class="item-action">
                        <strong>üëâ Action / R√©sum√© :</strong>
                        Fixe les prescriptions g√©n√©rales relatives aux pr√©l√®vements et √† la consommation d'eau ainsi qu'aux √©missions de toute nature des installations class√©es soumises √† autorisation. Implique une surveillance des rejets et des pr√©l√®vements d'eau, ainsi que la mise en place de mesures pour limiter leur impact sur l'environnement. (Action: V√©rifier la conformit√© des pr√©l√®vements et rejets d'eau aux valeurs limites fix√©es, mettre en place un syst√®me de surveillance et de reporting des donn√©es de pr√©l√®vement et de rejet, et s'assurer de la conformit√© des installations de traitement des eaux.)
                    </div>

                    <div class="item-action" style="background: #f0f7ff; border-left-color: #0ea5e9; margin-top: 10px;">
                        <strong>üõ°Ô∏è Preuve attendue (Audit) :</strong>
                        <textarea id="proof_47" style="font-size: 0.9em; color: #1e40af; font-style: italic; background: transparent; border: 1px dashed #0ea5e9; height: 60px; margin-top: 5px;"
                                  onblur="syncProof(47, this.value)">Rapports d'autosurveillance des rejets (eaux et air) et r√©sultats d'analyses par un laboratoire agr√©√© | Haute</textarea>
                    </div>

                    <div class="status-bar">
                        <label class="status-option">
                            <input type="radio" name="status_47" value="conforme" onclick="executeAction('conforme', 47)"> ‚úÖ Conforme
                        </label>
                        <label class="status-option">
                            <input type="radio" name="status_47" value="non_conforme" onclick="executeAction('non_conforme', 47)"> ‚ùå Non Conforme
                        </label>
                        <label class="status-option" style="background: #fee2e2; border-color: #fca5a5;">
                            <input type="checkbox" id="proof_check_47"  
                                   onchange="toggleProof(47, this.checked)"> üìÅ Preuve Dispo
                        </label>
                        <label class="status-option">
                            <input type="radio" name="status_47" value="info" onclick="executeAction('info', 47)"> ‚ÑπÔ∏è Pour Info
                        </label>
                    </div>
                        <label class="status-option">
                            <input type="radio" name="status_47" value="supprimer" onclick="executeAction('supprimer', 47)"> üóëÔ∏è Supprimer
                        </label>
                    </div>

                    <div class="obs-section">
                        <label class="obs-label">Observations :</label>
                        <textarea id="obs_47" placeholder="Saisir vos remarques ici..." 
                                  onblur="syncObservation(47, this.value)"></textarea>
                    </div>

                </div> </div>
            <div class="theme-section">
                <div class="theme-header">ENVIRONNEMENT SONORE (1)</div>
            
                <div class="item crit-moyenne" data-crit="Moyenne" data-type="MEC" data-proof="Non">
                    <div class="item-header">
                        <div class="item-title">
                            <span class="row-badge">Sheet Ligne: 49</span>
                            <a href="https://www.google.com/search?q=Bruit,+nuisances+sonores+et+pollution+sonore" target="_blank">Bruit, nuisances sonores et pollution sonore</a>
                        </div>
                    </div>
                    <div class="item-meta">
                        <span class="tag">üìÖ Texte: 25/06/1980</span>
                        <span class="tag">üìÑ Type: Arr√™t√©</span>
                        <span class="tag">üîç Dern. √âval: </span>
                        <span class="tag bg-red-100 text-red-800" id="proof-tag-49">‚ùå En attente de preuve physique</span>
                    </div>
                    
                    <div class="item-action">
                        <strong>üëâ Action / R√©sum√© :</strong>
                        √âvaluation des impacts du nouveau texte r√©glementaire sur le bruit et les nuisances sonores pour GDD, incluant la conformit√© des activit√©s de d√©coupage et ICPE. (Action: √âvaluer les niveaux sonores des √©quipements (d√©coupeuses, compresseurs, etc.), identifier les sources de bruit excessives, et mettre en place des mesures de r√©duction du bruit (isolation, √©crans acoustiques, maintenance pr√©ventive). V√©rifier la conformit√© aux √©ventuelles VLE sonores fix√©es par le texte.)
                    </div>

                    <div class="item-action" style="background: #f0f7ff; border-left-color: #0ea5e9; margin-top: 10px;">
                        <strong>üõ°Ô∏è Preuve attendue (Audit) :</strong>
                        <textarea id="proof_49" style="font-size: 0.9em; color: #1e40af; font-style: italic; background: transparent; border: 1px dashed #0ea5e9; height: 60px; margin-top: 5px;"
                                  onblur="syncProof(49, this.value)">Registre de s√©curit√© incendie √† jour, incluant les rapports de v√©rification annuelle des installations √©lectriques et des syst√®mes de d√©senfumage. | Rapports de mesures sonores, registre de maintenance des √©quipements bruyants, proc√©dures de contr√¥le du bruit, plan d'actions de r√©duction du bruit (si applicable).</textarea>
                    </div>

                    <div class="status-bar">
                        <label class="status-option">
                            <input type="radio" name="status_49" value="conforme" onclick="executeAction('conforme', 49)"> ‚úÖ Conforme
                        </label>
                        <label class="status-option">
                            <input type="radio" name="status_49" value="non_conforme" onclick="executeAction('non_conforme', 49)"> ‚ùå Non Conforme
                        </label>
                        <label class="status-option" style="background: #fee2e2; border-color: #fca5a5;">
                            <input type="checkbox" id="proof_check_49"  
                                   onchange="toggleProof(49, this.checked)"> üìÅ Preuve Dispo
                        </label>
                        <label class="status-option">
                            <input type="radio" name="status_49" value="info" onclick="executeAction('info', 49)"> ‚ÑπÔ∏è Pour Info
                        </label>
                    </div>
                        <label class="status-option">
                            <input type="radio" name="status_49" value="supprimer" onclick="executeAction('supprimer', 49)"> üóëÔ∏è Supprimer
                        </label>
                    </div>

                    <div class="obs-section">
                        <label class="obs-label">Observations :</label>
                        <textarea id="obs_49" placeholder="Saisir vos remarques ici..." 
                                  onblur="syncObservation(49, this.value)">https://www.ecologie.gouv.fr/politiques-publiques/bruit-nuisances-sonores-pollution-sonore</textarea>
                    </div>

                </div> </div>
            <div class="theme-section">
                <div class="theme-header">ICPE (1)</div>
            
                <div class="item crit-haute" data-crit="Haute" data-type="MEC" data-proof="Non">
                    <div class="item-header">
                        <div class="item-title">
                            <span class="row-badge">Sheet Ligne: 46</span>
                            <a href="https://www.google.com/search?q=Arr√™t√©+du+24+ao√ªt+2023+relatif+aux+prescriptions+g√©n√©rales+applicables+aux+installations+relevant+du+r√©gime+de+l'enregistrement+au+titre+de+la+rubrique+2560+de+la+nomenclature+des+installations+class√©es+pour+la+protection+de+l'environnement" target="_blank">Arr√™t√© du 24 ao√ªt 2023 relatif aux prescriptions g√©n√©rales applicables aux installations relevant du r√©gime de l'enregistrement au titre de la rubrique 2560 de la nomenclature des installations class√©es pour la protection de l'environnement</a>
                        </div>
                    </div>
                    <div class="item-meta">
                        <span class="tag">üìÖ Texte: 24/08/2023</span>
                        <span class="tag">üìÑ Type: Arr√™t√©</span>
                        <span class="tag">üîç Dern. √âval: </span>
                        <span class="tag bg-red-100 text-red-800" id="proof-tag-46">‚ùå En attente de preuve physique</span>
                    </div>
                    
                    <div class="item-action">
                        <strong>üëâ Action / R√©sum√© :</strong>
                        Prescriptions g√©n√©rales applicables aux installations relevant du r√©gime de l'enregistrement au titre de la rubrique 2560 (Ateliers de m√©tallurgie mettant en oeuvre des proc√©d√©s de traitement de surface). Cet arr√™t√© d√©taille les exigences concernant les rejets atmosph√©riques, les rejets aqueux, la gestion des d√©chets, la pr√©vention des accidents et la remise en √©tat du site. (Action: V√©rifier la conformit√© des installations de traitement de surface (rubrique 2560) de GDD avec les nouvelles prescriptions g√©n√©rales, notamment en mati√®re de rejets atmosph√©riques et aqueux, de gestion des d√©chets et de pr√©vention des risques.)
                    </div>

                    <div class="item-action" style="background: #f0f7ff; border-left-color: #0ea5e9; margin-top: 10px;">
                        <strong>üõ°Ô∏è Preuve attendue (Audit) :</strong>
                        <textarea id="proof_46" style="font-size: 0.9em; color: #1e40af; font-style: italic; background: transparent; border: 1px dashed #0ea5e9; height: 60px; margin-top: 5px;"
                                  onblur="syncProof(46, this.value)">Rapport de contr√¥le p√©riodique de conformit√© initial ou quinquennal r√©alis√© par un organisme agr√©√© (V√©rification des prescriptions de l'enregistrement). | Haute</textarea>
                    </div>

                    <div class="status-bar">
                        <label class="status-option">
                            <input type="radio" name="status_46" value="conforme" onclick="executeAction('conforme', 46)"> ‚úÖ Conforme
                        </label>
                        <label class="status-option">
                            <input type="radio" name="status_46" value="non_conforme" onclick="executeAction('non_conforme', 46)"> ‚ùå Non Conforme
                        </label>
                        <label class="status-option" style="background: #fee2e2; border-color: #fca5a5;">
                            <input type="checkbox" id="proof_check_46"  
                                   onchange="toggleProof(46, this.checked)"> üìÅ Preuve Dispo
                        </label>
                        <label class="status-option">
                            <input type="radio" name="status_46" value="info" onclick="executeAction('info', 46)"> ‚ÑπÔ∏è Pour Info
                        </label>
                    </div>
                        <label class="status-option">
                            <input type="radio" name="status_46" value="supprimer" onclick="executeAction('supprimer', 46)"> üóëÔ∏è Supprimer
                        </label>
                    </div>

                    <div class="obs-section">
                        <label class="obs-label">Observations :</label>
                        <textarea id="obs_46" placeholder="Saisir vos remarques ici..." 
                                  onblur="syncObservation(46, this.value)"></textarea>
                    </div>

                </div> </div>
            <div class="theme-section">
                <div class="theme-header">ICPE, S√©curit√©, D√©chets (1)</div>
            
                <div class="item crit-haute" data-crit="Haute" data-type="MEC" data-proof="Non">
                    <div class="item-header">
                        <div class="item-title">
                            <span class="row-badge">Sheet Ligne: 40</span>
                            <a href="https://www.google.com/search?q=Arr√™t√©+du+11+avril+2017+relatif+aux+prescriptions+g√©n√©rales+..." target="_blank">Arr√™t√© du 11 avril 2017 relatif aux prescriptions g√©n√©rales ...</a>
                        </div>
                    </div>
                    <div class="item-meta">
                        <span class="tag">üìÖ Texte: 11/04/2017</span>
                        <span class="tag">üìÑ Type: Arr√™t√©</span>
                        <span class="tag">üîç Dern. √âval: </span>
                        <span class="tag bg-red-100 text-red-800" id="proof-tag-40">‚ùå En attente de preuve physique</span>
                    </div>
                    
                    <div class="item-action">
                        <strong>üëâ Action / R√©sum√© :</strong>
                        L'Arr√™t√© du 11 avril 2017 fixe les prescriptions g√©n√©rales applicables aux installations relevant du r√©gime de l'enregistrement au titre de la rubrique 2564 de la nomenclature des installations class√©es pour la protection de l'environnement (ICPE) : application de peintures, vernis, √©maux ou encres sur des supports quelconques par un proc√©d√© quelconque, √† l'exclusion des activit√©s de marquage r√©alis√©es en imprimerie. (Action: V√©rifier la conformit√© des installations de GDD relevant de la rubrique 2564 (application de peintures, vernis, √©maux ou encres) avec les prescriptions de l'arr√™t√© (ex: gestion des solvants, VLE, pr√©vention des risques). Mettre en place ou adapter les proc√©dures op√©rationnelles et les moyens de contr√¥le si n√©cessaire.)
                    </div>

                    <div class="item-action" style="background: #f0f7ff; border-left-color: #0ea5e9; margin-top: 10px;">
                        <strong>üõ°Ô∏è Preuve attendue (Audit) :</strong>
                        <textarea id="proof_40" style="font-size: 0.9em; color: #1e40af; font-style: italic; background: transparent; border: 1px dashed #0ea5e9; height: 60px; margin-top: 5px;"
                                  onblur="syncProof(40, this.value)">Rapport de contr√¥le p√©riodique de l'installation de combustion par un organisme agr√©√© (rubrique 2910) et livret de maintenance de la chaudi√®re.</textarea>
                    </div>

                    <div class="status-bar">
                        <label class="status-option">
                            <input type="radio" name="status_40" value="conforme" onclick="executeAction('conforme', 40)"> ‚úÖ Conforme
                        </label>
                        <label class="status-option">
                            <input type="radio" name="status_40" value="non_conforme" onclick="executeAction('non_conforme', 40)"> ‚ùå Non Conforme
                        </label>
                        <label class="status-option" style="background: #fee2e2; border-color: #fca5a5;">
                            <input type="checkbox" id="proof_check_40"  
                                   onchange="toggleProof(40, this.checked)"> üìÅ Preuve Dispo
                        </label>
                        <label class="status-option">
                            <input type="radio" name="status_40" value="info" onclick="executeAction('info', 40)"> ‚ÑπÔ∏è Pour Info
                        </label>
                    </div>
                        <label class="status-option">
                            <input type="radio" name="status_40" value="supprimer" onclick="executeAction('supprimer', 40)"> üóëÔ∏è Supprimer
                        </label>
                    </div>

                    <div class="obs-section">
                        <label class="obs-label">Observations :</label>
                        <textarea id="obs_40" placeholder="Saisir vos remarques ici..." 
                                  onblur="syncObservation(40, this.value)">https://www.legifrance.gouv.fr/loda/id/JORFTEXT000034429274/2026-01-22</textarea>
                    </div>

                </div> </div>
            <div class="theme-section">
                <div class="theme-header">S√©curit√© des installations, ICPE (1)</div>
            
                <div class="item crit-haute" data-crit="Haute" data-type="MEC" data-proof="Non">
                    <div class="item-header">
                        <div class="item-title">
                            <span class="row-badge">Sheet Ligne: 32</span>
                            <a href="https://www.legifrance.gouv.fr/loda/id/LEGITEXT000020303557" target="_blank">Arr√™t√© du 25 juin 1980 portant approbation des dispositions ...</a>
                        </div>
                    </div>
                    <div class="item-meta">
                        <span class="tag">üìÖ Texte: 25/06/1980</span>
                        <span class="tag">üìÑ Type: Arr√™t√©</span>
                        <span class="tag">üîç Dern. √âval: </span>
                        <span class="tag bg-red-100 text-red-800" id="proof-tag-32">‚ùå En attente de preuve physique</span>
                    </div>
                    
                    <div class="item-action">
                        <strong>üëâ Action / R√©sum√© :</strong>
                        Cet arr√™t√© de 1980 approuve des dispositions d√©finissant les termes 'conduit' et 'gaine', fondamentaux pour la compr√©hension des r√©glementations techniques et de s√©curit√© des installations. (Action: Rechercher le texte int√©gral de l'arr√™t√© pour √©valuer sa port√©e compl√®te et son applicabilit√© aux installations du site, notamment en mati√®re de s√©curit√© incendie, de ventilation ou de gestion des flux, et v√©rifier s'il est toujours en vigueur ou a √©t√© abrog√©/remplac√©.)
                    </div>

                    <div class="item-action" style="background: #f0f7ff; border-left-color: #0ea5e9; margin-top: 10px;">
                        <strong>üõ°Ô∏è Preuve attendue (Audit) :</strong>
                        <textarea id="proof_32" style="font-size: 0.9em; color: #1e40af; font-style: italic; background: transparent; border: 1px dashed #0ea5e9; height: 60px; margin-top: 5px;"
                                  onblur="syncProof(32, this.value)">Registre de s√©curit√© √† jour incluant les rapports de v√©rification p√©riodique des installations de d√©tection et d'extinction d'incendie (extincteurs, RIA).</textarea>
                    </div>

                    <div class="status-bar">
                        <label class="status-option">
                            <input type="radio" name="status_32" value="conforme" onclick="executeAction('conforme', 32)"> ‚úÖ Conforme
                        </label>
                        <label class="status-option">
                            <input type="radio" name="status_32" value="non_conforme" onclick="executeAction('non_conforme', 32)"> ‚ùå Non Conforme
                        </label>
                        <label class="status-option" style="background: #fee2e2; border-color: #fca5a5;">
                            <input type="checkbox" id="proof_check_32"  
                                   onchange="toggleProof(32, this.checked)"> üìÅ Preuve Dispo
                        </label>
                        <label class="status-option">
                            <input type="radio" name="status_32" value="info" onclick="executeAction('info', 32)"> ‚ÑπÔ∏è Pour Info
                        </label>
                    </div>
                        <label class="status-option">
                            <input type="radio" name="status_32" value="supprimer" onclick="executeAction('supprimer', 32)"> üóëÔ∏è Supprimer
                        </label>
                    </div>

                    <div class="obs-section">
                        <label class="obs-label">Observations :</label>
                        <textarea id="obs_32" placeholder="Saisir vos remarques ici..." 
                                  onblur="syncObservation(32, this.value)"></textarea>
                    </div>

                </div> </div>
            </div> <div class="footer">
                G√©n√©r√© par l'Assistant Veille R√©glementaire GDD, Anthony, Service Data&IA
            </div>
            
            </div> 
            
            <script>
                const SHEET_NAME = "Rapport_Veille_Auto";
                const API_BASE = "http://127.0.0.1:5000";

                function showLoading(show) {
                    document.getElementById('save-indicator').style.display = show ? 'block' : 'none';
                }

                async function toggleProof(rowIdx, isChecked) {
                    const statusVal = isChecked ? 'Oui' : 'Non';
                    showLoading(true);
                    try {
                        const res = await fetch(`${API_BASE}/sync-observation`, { // On r√©utilise sync pour √©conomiser un endpoint ou on en cr√©e un
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ 
                                sheet_name: SHEET_NAME, 
                                row_idx: rowIdx, 
                                column: 'Preuves disponibles',
                                text: statusVal 
                            })
                        });
                        const data = await res.json();
                        if (data.success) {
                            const tag = document.getElementById(`proof-tag-${rowIdx}`);
                            tag.className = `tag ${isChecked ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`;
                            tag.innerText = isChecked ? "‚úÖ Preuve de conformit√© disponible" : "‚ùå En attente de preuve physique";
                            
                            // Colorer le label du checkbox
                            const checkbox = document.getElementById(`proof_check_${rowIdx}`);
                            checkbox.parentElement.style.background = isChecked ? '#dcfce7' : '#fee2e2';
                            checkbox.parentElement.style.borderColor = isChecked ? '#86efac' : '#fca5a5';
                        }
                    } catch (e) {
                        alert("Erreur de synchronisation Preuves.");
                    }
                    showLoading(false);
                }

                async function syncObservation(rowIdx, text) {
                    showLoading(true);
                    try {
                        const res = await fetch(`${API_BASE}/sync-observation`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ sheet_name: SHEET_NAME, row_idx: rowIdx, text: text })
                        });
                        const data = await res.json();
                        if (data.success) console.log('Observation synced');
                    } catch (e) {
                        alert("Erreur de synchronisation. V√©rifiez que le serveur Flask tourne.");
                    }
                    showLoading(false);
                }

                async function syncProof(rowIdx, text) {
                    showLoading(true);
                    try {
                        const res = await fetch(`${API_BASE}/sync-observation`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ 
                                sheet_name: SHEET_NAME, 
                                row_idx: rowIdx, 
                                column: 'Preuve de Conformit√© Attendue',
                                text: text 
                            })
                        });
                        const data = await res.json();
                        if (data.success) console.log('Proof synced');
                    } catch (e) {
                        alert("Erreur de synchronisation Preuve.");
                    }
                    showLoading(false);
                }

                async function executeAction(action, rowIdx) {
                    if (action === 'supprimer' && !confirm('Supprimer d√©finitivement cette ligne ?')) return;
                    
                    showLoading(true);
                    try {
                        const res = await fetch(`${API_BASE}/execute-action`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ action: action, sheet_name: SHEET_NAME, row_idx: rowIdx })
                        });
                        const data = await res.json();
                        if (data.success) {
                            // Effet visuel : Geler la carte
                            const inputs = document.getElementsByName(`status_${rowIdx}`);
                            const card = inputs[0].closest('.item');
                            card.classList.add('processed');
                            
                            // Ajout bouton Annuler (Un-grey)
                            if (!card.querySelector('.undo-btn')) {
                                const undoBtn = document.createElement('button');
                                undoBtn.className = 'undo-btn';
                                undoBtn.innerText = '‚Ü∫ Annuler la validation (D√©griser)';
                                undoBtn.style.cssText = 'margin-top: 12px; padding: 6px 12px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; display: block; font-size: 0.8em; font-weight: 600;';
                                undoBtn.onclick = () => {
                                    card.classList.remove('processed');
                                    undoBtn.remove();
                                };
                                card.appendChild(undoBtn);
                            }
                        }
                    } catch (e) {
                        alert("Erreur d'action. V√©rifiez que le serveur Flask tourne.");
                    }
                    showLoading(false);
                }
                function filterItems(attr, val, btn) {
                    const items = document.querySelectorAll('.item');
                    const buttons = document.querySelectorAll('.filter-btn');
                    
                    buttons.forEach(b => b.classList.remove('active'));
                    if (btn) btn.classList.add('active');

                    items.forEach(item => {
                        if (attr === 'all') {
                            item.style.display = 'block';
                        } else if (attr === 'crit') {
                            item.style.display = (item.getAttribute('data-crit') === val) ? 'block' : 'none';
                        } else if (attr === 'type') {
                            item.style.display = (item.getAttribute('data-type') === val) ? 'block' : 'none';
                        }
                    });
                }
            </script>
        </body>
        </html>
        